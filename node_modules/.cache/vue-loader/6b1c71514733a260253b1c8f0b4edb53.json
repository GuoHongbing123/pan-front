{"remainingRequest":"E:\\vuedemo\\test\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\vuedemo\\test\\src\\views\\Home.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\vuedemo\\test\\src\\views\\Home.vue","mtime":1638515671139},{"path":"E:\\vuedemo\\test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\vuedemo\\test\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"E:\\vuedemo\\test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\vuedemo\\test\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldEZpbGVCeUlkLGdldExvY2F0aW9uLG1vdmVGb2xkZXIgfSBmcm9tICIuLi9hcGkvZm9sZGVyIjsKaW1wb3J0IHsgbW92ZUZpbGUgfSBmcm9tICIuLi9hcGkvZmlsZSI7CmltcG9ydCAgRmlsZSAgZnJvbSAiLi4vY29tcG9uZW50cy9GaWxlLnZ1ZSI7CmltcG9ydCBTZWxlY3RGb2xkZXIgZnJvbSAiLi4vY29tcG9uZW50cy9TZWxlY3RGb2xkZXIudnVlIjsKaW1wb3J0IFNoYXJlTW9kYWwgZnJvbSAiLi4vY29tcG9uZW50cy9TaGFyZU1vZGFsLnZ1ZSI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnSG9tZScsCiAgZGF0YSgpIHsKICAgIHJldHVybnsKICAgICAgbGlzdDpbXSwKICAgICAgYnJlYWQ6W10sCiAgICAgIGN1cnJlbnRGb2xkZXJJZDonJywKICAgICAgc2VsZWN0U2hvdzpmYWxzZSwKICAgICAgc2hhcmVTaG93OmZhbHNlCiAgICB9CiAgfSwKICBjb21wb25lbnRzOnsKICAgIEZpbGUsCiAgICBTZWxlY3RGb2xkZXIsCiAgICBTaGFyZU1vZGFsCiAgfSwKICB3YXRjaDp7CiAgICAkcm91dGUobmV3VmFsKXsKICAgICAgdGhpcy5jdXJyZW50Rm9sZGVySWQ9bmV3VmFsLnF1ZXJ5LmlkCiAgICAgIHRoaXMuZ2V0RmlsZXMoKQogICAgICB0aGlzLnNldExvY2F0aW9uKCkKICAgIH0KICB9LAogIG1ldGhvZHM6ewogICAgZHJhZ1N0YXJ0KGUsIGl0ZW0pewogICAgICBlLmRhdGFUcmFuc2Zlci5lZmZlY3RBbGxvd2VkID0gJ21vdmUnCiAgICAgIGUuZGF0YVRyYW5zZmVyLnNldERhdGEoJ2lkJywgaXRlbS5pZCkKICAgICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YSgndHlwZScsaXRlbS50eXBlKQogICAgfSwKICAgIGRyb3AoZSxpdGVtKXsKICAgICAgdGhpcy5tb3ZlKHsKICAgICAgICB0eXBlOmUuZGF0YVRyYW5zZmVyLmdldERhdGEoJ3R5cGUnKSwKICAgICAgICBpZDplLmRhdGFUcmFuc2Zlci5nZXREYXRhKCdpZCcpLAogICAgICAgIGZvbGRlcklkOml0ZW0uaWQKICAgICAgfSkKICAgIH0sCiAgICBhbGxvd0Ryb3AoZSwgaXRlbSl7CiAgICAgIGlmKGl0ZW0udHlwZT09PScyJyl7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBtb3ZlKGRhdGEpewogICAgICBsZXQgcmVzPWRhdGEudHlwZSA9PT0gJzInID8gYXdhaXQgbW92ZUZvbGRlcihkYXRhKSA6IGF3YWl0IG1vdmVGaWxlKGRhdGEpCiAgICAgIGlmKHJlcy5jb2RlID09PSAwKXsKICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoJ+enu+WKqOaIkOWKnycpCiAgICAgICAgdGhpcy5nZXRGaWxlcygpCiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1zZyk7CiAgICAgIH0KICAgIH0sCgogICAgaGFuZGxlTW92ZShpbmZvKXsKICAgICAgdGhpcy5zZWxlY3RTaG93PXRydWUKICAgICAgdGhpcy4kbmV4dFRpY2soKCk9PnsKICAgICAgICB0aGlzLiRyZWZzLnNlbGVjdC5kaWFsb2dWaXNpYmxlPXRydWUKICAgICAgICB0aGlzLiRyZWZzLnNlbGVjdC5pbml0KGluZm8pCiAgICAgIH0pCiAgICB9LAogICAgaGFuZGxlU2hhcmUoaW5mbyl7CiAgICAgIHRoaXMuc2hhcmVTaG93PXRydWUKICAgICAgdGhpcy4kbmV4dFRpY2soKCk9PnsKICAgICAgICB0aGlzLiRyZWZzLnNoYXJlLnZpc2libGU9dHJ1ZQogICAgICAgIHRoaXMuJHJlZnMuc2hhcmUuaW5pdChpbmZvKQogICAgICB9KQogICAgfSwKICAgIGhhbmRsZUJyZWFkKGlkLGluZGV4KXsKICAgICAgaWYoaW5kZXghPT10aGlzLmJyZWFkLmxlbmd0aC0xKXsKICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCgnL2hvbWU/aWQ9JytpZCkKICAgICAgfQogICAgfSwKICAgIHNldExvY2F0aW9uKCl7CiAgICAgIGlmKHRoaXMuY3VycmVudEZvbGRlcklkKXsKICAgICAgICBnZXRMb2NhdGlvbih0aGlzLmN1cnJlbnRGb2xkZXJJZCkudGhlbihyZXM9PnsKICAgICAgICAgIHRoaXMuYnJlYWQ9cmVzLmRhdGEucmV2ZXJzZSgpCiAgICAgICAgICB0aGlzLmJyZWFkWzBdLnJlYWxOYW1lPSfpppbpobUnCiAgICAgIH0pCiAgICAgIH1lbHNlewogICAgICAgIHRoaXMuYnJlYWQuc3BsaWNlKDAsdGhpcy5icmVhZC5sZW5ndGgpCiAgICAgIH0KICAgICAgCiAgICB9LAogICAgcmVuYW1lKGlkLG5ld05hbWUpewogICAgICBsZXQgaW5kZXg9dGhpcy5saXN0LmZpbmRJbmRleChpdGVtPT57CiAgICAgICAgcmV0dXJuIGl0ZW0uaWQgPT0gaWQKICAgICAgfSkKICAgICAgdGhpcy5saXN0W2luZGV4XS5yZWFsTmFtZSA9IG5ld05hbWUKICAgIH0sCiAgICBnZXRGaWxlcygpewogICAgICBnZXRGaWxlQnlJZCh0aGlzLmN1cnJlbnRGb2xkZXJJZCkudGhlbigocmVzKT0+ewogICAgICAgIHRoaXMubGlzdD1bLi4ucmVzLmRhdGEuZm9sZGVyLC4uLnJlcy5kYXRhLmZpbGVdCiAgICAgIH0pCiAgICB9LAogICAgY2xpY2tIYW5kZXIoZmlsZSl7CiAgICAgIGlmKGZpbGUudHlwZT09PScyJyl7CiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goe3BhdGg6Jy9ob21lP2lkPScrZmlsZS5pZH0pCiAgICAgIH0KICAgIH0KICB9LAogIG1vdW50ZWQoKXsKICAgIHRoaXMuZ2V0RmlsZXMoKQogICAgaWYodGhpcy4kcm91dGUucXVlcnkuaWQpewogICAgICB0aGlzLnNldExvY2F0aW9uKCkKICAgIH0KICAgIHRoaXMuJGJ1cy4kb24oJ2dldGxpc3QnLHRoaXMuZ2V0RmlsZXMpCiAgfQp9Cg=="},{"version":3,"sources":["Home.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Home.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"home\">\n    <div class=\"breadcrumb-box\">\n      <div class=\"breadcrumb-item\" v-for=\"(item,index) in bread\" :key=\"item.id\">\n        <i v-if=\"index!==0\" class=\"el-icon-arrow-right\"></i>\n        <span @click=\"handleBread(item.id,index)\" :class=\"{'clickable': index!==bread.length-1}\">{{item.realName}}</span>\n      </div>\n    </div>\n    <div class=\"list\">\n      <file \n        @renameSuccess=\"rename\" \n        @click.native=\"clickHander(item)\" \n        @move=\"handleMove\"\n        @share=\"handleShare\" \n        draggable=\"true\"\n        @dragover.native=\"(e) => allowDrop(e, item)\"\n        @dragstart.native=\"(e) => dragStart(e,item)\"\n        @drop.native=\"(e) => drop(e,item)\"\n        :info=\"item\" \n        v-for=\"item in list\" \n        :key=\"item.id\"></file>\n    </div>\n    <select-folder @moveSuccess=\"selectShow=false\" v-if=\"selectShow\" ref=\"select\"></select-folder>\n    <share-modal ref=\"share\" v-if=\"shareShow\"></share-modal>\n  </div>\n</template>\n\n<script>\nimport { getFileById,getLocation,moveFolder } from \"../api/folder\";\nimport { moveFile } from \"../api/file\";\nimport  File  from \"../components/File.vue\";\nimport SelectFolder from \"../components/SelectFolder.vue\";\nimport ShareModal from \"../components/ShareModal.vue\";\nexport default {\n  name: 'Home',\n  data() {\n    return{\n      list:[],\n      bread:[],\n      currentFolderId:'',\n      selectShow:false,\n      shareShow:false\n    }\n  },\n  components:{\n    File,\n    SelectFolder,\n    ShareModal\n  },\n  watch:{\n    $route(newVal){\n      this.currentFolderId=newVal.query.id\n      this.getFiles()\n      this.setLocation()\n    }\n  },\n  methods:{\n    dragStart(e, item){\n      e.dataTransfer.effectAllowed = 'move'\n      e.dataTransfer.setData('id', item.id)\n      e.dataTransfer.setData('type',item.type)\n    },\n    drop(e,item){\n      this.move({\n        type:e.dataTransfer.getData('type'),\n        id:e.dataTransfer.getData('id'),\n        folderId:item.id\n      })\n    },\n    allowDrop(e, item){\n      if(item.type==='2'){\n        e.preventDefault()\n      }\n    },\n    async move(data){\n      let res=data.type === '2' ? await moveFolder(data) : await moveFile(data)\n      if(res.code === 0){\n        this.$message.success('移动成功')\n        this.getFiles()\n      }else{\n        this.$message.error(res.msg);\n      }\n    },\n\n    handleMove(info){\n      this.selectShow=true\n      this.$nextTick(()=>{\n        this.$refs.select.dialogVisible=true\n        this.$refs.select.init(info)\n      })\n    },\n    handleShare(info){\n      this.shareShow=true\n      this.$nextTick(()=>{\n        this.$refs.share.visible=true\n        this.$refs.share.init(info)\n      })\n    },\n    handleBread(id,index){\n      if(index!==this.bread.length-1){\n        this.$router.push('/home?id='+id)\n      }\n    },\n    setLocation(){\n      if(this.currentFolderId){\n        getLocation(this.currentFolderId).then(res=>{\n          this.bread=res.data.reverse()\n          this.bread[0].realName='首页'\n      })\n      }else{\n        this.bread.splice(0,this.bread.length)\n      }\n      \n    },\n    rename(id,newName){\n      let index=this.list.findIndex(item=>{\n        return item.id == id\n      })\n      this.list[index].realName = newName\n    },\n    getFiles(){\n      getFileById(this.currentFolderId).then((res)=>{\n        this.list=[...res.data.folder,...res.data.file]\n      })\n    },\n    clickHander(file){\n      if(file.type==='2'){\n        this.$router.push({path:'/home?id='+file.id})\n      }\n    }\n  },\n  mounted(){\n    this.getFiles()\n    if(this.$route.query.id){\n      this.setLocation()\n    }\n    this.$bus.$on('getlist',this.getFiles)\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n.breadcrumb-box{\n  display: flex;\n}\n.clickable{\n  font-weight: bold;\n  cursor: pointer;\n}\n.list{\n  display: flex;\n  flex-wrap:wrap;\n}\n</style>"]}]}